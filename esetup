#!/bin/bash

prerequisites()
{
    echo "
configuring prerequisites..."
    sudo apt-get -y install --no-install-recommends make gcc automake autoconf
    sudo apt-get -y install --no-install-recommends g++ git
    echo "
... done"
}

ag_setup()
{
    echo "
configuring ag..."
    sudo apt-get -y install --no-install-recommends silversearcher-ag
    echo "
... done"
}

scheme_setup()
{
    echo "
configuring Scheme..."
    sudo apt-get -y install --no-install-recommends guile-2.0
    echo "
... done"
}

commonlisp_setup()
{
    echo "
configuring Common Lisp..."
    sudo apt-get -y install --no-install-recommends sbcl slime sbcl-doc
    sudo apt-get -y install --no-install-recommends cl-clx-sbcl cl-ppcre
    sudo apt-get -y install --no-install-recommends texinfo cl-swank
    echo "
... done"
}

clojure_setup()
{
    echo "
configuring Clojure..."
    sudo apt-get -y install --no-install-recommends openjdk-8-jre
    echo "
getting Lein..."
    if [ ! -d "/home/manuel/bin" ]; then
	mkdir -p /home/manuel/bin
	export PATH=$PATH:/home/manuel/bin
    fi
    wget https://raw.githubusercontent.com/technomancy/leiningen/stable/bin/lein -O /home/manuel/bin/lein
    chmod 755 /home/manuel/bin/lein
    echo "
... done"
}

latex_setup()
{
    echo "
configuring LaTeX..."
    sudo apt-get -y install --no-install-recommends texlive-latex-base
    sudo apt-get -y install --no-install-recommends texlive-latex-recommended
    sudo apt-get -y install --no-install-recommends latexmk texlive-xetex
    sudo apt-get -y install --no-install-recommends texlive-luatex luatex
    sudo apt-get -y install --no-install-recommends texlive-latex-extra
    sudo apt-get -y install --no-install-recommends texlive-fonts-recommended
    sudo apt-get -y install --no-install-recommends texlive-fonts-extra
    sudo apt-get -y install --no-install-recommends texlive-generic-recommended
    sudo apt-get -y install --no-install-recommends texlive-math-extra
    sudo apt-get -y install --no-install-recommends texlive-lang-italian
    sudo apt-get -y install --no-install-recommends texlive-lang-english
    sudo apt-get -y install --no-install-recommends cjk-latex latex-cjk-all
    sudo apt-get -y install --no-install-recommends texlive-lang-cjk
    sudo apt-get -y install --no-install-recommends texlive-chinese-lang
    sudo apt-get -y install --no-install-recommends latex-xcolor fonts-lmodern lmodern
    echo "
... done. Configuring chktex for Flycheck..."
    if [ ! -d "/home/manuel/sources" ]; then
	mkdir -p /home/manuel/sources
    fi
    cd /home/manuel/sources
    wget http://download.savannah.gnu.org/releases/chktex/chktex-1.7.2.tar.gz
    tar xzf chktex-1.7.2.tar.gz
    rm chktex-1.7.2.tar.gz
    cd chktex-1.7.2
    ./configure --enable-lacheck-replace && make
    sudo make install
    cp /usr/local/etc/chktexrc /home/manuel/.chktexrc
    echo "
... done"
    cd /home/manuel
}

pandoc_setup()
{
    echo "
configuring Pandoc..."
    sudo apt-get -y install --no-install-recommends pandoc
    echo "
... done"
}

pdftools_setup()
{
    echo "
configuring pdf-tools..."
    echo "
configuring dependencies..."
    sudo apt-get -y install --no-install-recommends libpng-dev libz-dev
    sudo apt-get -y install --no-install-recommends libpoppler-glib-dev
    sudo apt-get -y install --no-install-recommends -t experimental libpoppler-private-dev
    sudo apt-get -y install --no-install-recommends imagemagick
    echo "
... done. Building pdf-tools..."
    if [ ! -d "/home/manuel/githubs" ]; then
	mkdir -p /home/manuel/githubs
    fi
    cd /home/manuel/githubs
    git clone https://github.com/politza/pdf-tools
    cd pdf-tools
    ./autogen.sh
    ./configure && make
    make install-package
    echo "
... done"
    cd /home/manuel
}

flyspell_setup()
{
    echo "
configuring flyspell..."
    sudo apt-get -y install --no-install-recommends aspell aspell-en aspell-it
    echo "
... done"
}

synosaurus_setup()
{
    echo "
configuring synosaurus..."
    sudo apt-get -y install --no-install-recommends wordnet
    echo "
... done"
}

langtool_setup()
{
    echo "
configuring langtool..."
    if [ ! -d "/home/manuel/emacs" ]; then
	mkdir -p /home/manuel/emacs
    fi
    if [ ! -x /usr/bin/unzip ]; then
        sudo apt-get -y install --no-install-recommends unzip
    fi
    cd /home/manuel/emacs
    wget https://www.languagetool.org/download/LanguageTool-2.8.zip
    unzip LanguageTool-2.8.zip
    mv LanguageTool-2.8 languagetool-2.8
    rm LanguageTool-2.8.zip
    echo "
... done"
}

font_setup()
{
    echo "
configuring DejaVu fonts..."
    sudo apt-get -y install --no-install-recommends fonts-dejavu fonts-dejavu-extra
    echo "
configuring Souce Code Pro..."
    if [ ! -d "/home/manuel/.fonts" ]; then
	mkdir -p /home/manuel/.fonts
    fi
    cd /home/manuel
    wget https://github.com/adobe-fonts/source-code-pro/archive/1.017R.tar.gz
    tar xzf 1.017R.tar.gz
    cd source-code-pro-1.017R
    cp -r /home/manuel/source-code-pro-1.017R/TTF /home/manuel/.fonts/souce-code-pro
    rm -rf source-code-pro-1.017R 1.017R.tar.gz
    fc-cache -fv
    echo "
... done"
}

echo "
##########################################
# esetup                                 #
# Script for creating the right          #
# environment for my Emacs configuration #
##########################################"

sudo -v # gets user password for next sudos

cd /home/manuel
prerequisites
ag_setup
scheme_setup
commonlisp_setup
clojure_setup
latex_setup
pandoc_setup
pdftools_setup
flyspell_setup
synosaurus_setup
langtool_setup
font_setup

echo "
environment ready, now fire up Emacs!
"
